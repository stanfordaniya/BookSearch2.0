<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Search 2.0</title>
    <style>
        /* Main Styles */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7fc;
            color: #333;
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 1100px;
            margin: 60px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5em;
            color: #000000;
            text-align: center;
            margin-bottom: 30px;
        }

        /* Sign-In Button Container */
        .signin-container {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        /* Search Bar */
        .search-bar {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .search-bar input {
            width: 60%;
            padding: 12px;
            font-size: 1.2em;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-right: 10px;
        }

        .search-bar button {
            padding: 12px 20px;
            background-color: #000000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .search-bar button:hover {
            background-color: #2980b9;
        }

        /* View Toggle Buttons */
        .view-toggle {
            text-align: center;
            margin-bottom: 20px;
        }

        .view-toggle button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .view-toggle button:hover {
            background-color: #2980b9;
        }

        /* Book List */
        .book-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .book-item {
            background-color: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .book-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }

        .book-item img {
            max-width: 100px;
            margin-bottom: 15px;
        }

        .book-item a {
            font-size: 1.2em;
            color: #000000;
            text-decoration: none;
            font-weight: bold;
        }

        .book-item a:hover {
            color: #2980b9;
        }

        .grid-view .book-item {
            display: block;
        }

        .list-view .book-list {
            display: block;
        }

        .list-view .book-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin-bottom: 10px;
        }

        .list-view .book-item img {
            margin-right: 20px;
            width: 100px;
        }

        /* Pagination */
        .pagination {
            text-align: center;
            margin-top: 30px;
        }

        .pagination button {
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 0 5px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            display: inline-block;
            font-size: 1em;
            font-weight: bold;
        }

        .pagination button.active {
            background-color: #2980b9;
        }

        .pagination button:hover {
            background-color: #2980b9;
        }

        /* Book Details */
        .book-details {
            margin-top: 40px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* User Info */
        #user-info {
            text-align: center;
            margin-top: 20px;
            margin-bottom: 20px;
        }

        #user-info img {
            border-radius: 50%;
            width: 100px;
        }

        #user-info h3 {
            margin: 10px 0;
        }

        #user-info button {
            padding: 10px 15px;
            background-color: #000000;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        #user-info button:hover {
            background-color: #2980b9;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Book Search</h1>

        <!-- Google Sign-In Button -->
        <div class="signin-container">
            <div id="g_id_onload"
                data-client_id="873205161879-mafc144b5163303ev0jcuei9qjehu2rh.apps.googleusercontent.com"
                data-callback="handleCredentialResponse"
                data-auto_prompt="false"
                data-scope="https://www.googleapis.com/auth/books">
            </div>
            <div class="g_id_signin" data-type="standard"></div>
        </div>

        <!-- User Info after Sign-In -->
        <div id="user-info"></div>

        <!-- Search Bar -->
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search for books...">
            <button id="searchButton">Search</button>
        </div>

        <!-- View Toggle Buttons -->
        <div class="view-toggle">
            <button id="gridViewButton">Grid View</button>
            <button id="listViewButton">List View</button>
        </div>

        <!-- Book List for search results -->
        <div class="book-list grid-view" id="bookList"></div>

        <!-- Pagination -->
        <div class="pagination" id="pagination"></div>

        <!-- Book Details -->
        <div class="book-details" id="bookDetails"></div>

        <!-- Bookshelf -->
        <div class="bookshelf">
            <h2>My Library</h2>
            <div class="book-list grid-view" id="bookshelfList"></div>
        </div>
    </div>

    <!-- Mustache Template for Books -->
    <script id="book-template" type="x-tmpl-mustache">
        <div class="book-item">
            <img src="{{image}}" alt="{{title}}">
            <div>
                <a href="{{infoLink}}" target="_blank">{{title}}</a>
                <p>{{authors}}</p>
            </div>
        </div>
    </script>

    <!-- Include Google Identity Services, jQuery, and Mustache.js -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/4.2.0/mustache.min.js"></script>

    <script>
        let accessToken;
        const booksPerPage = 10;

        // Google Sign-In handler
        function handleCredentialResponse(response) {
            const responsePayload = parseJwt(response.credential);

            document.getElementById('user-info').innerHTML = `
                <h3>Welcome, ${responsePayload.name}</h3>
                <p>Email: ${responsePayload.email}</p>
                <img src="${responsePayload.picture}" alt="Profile Picture" />
                <br>
                <button onclick="signOut()">Sign out</button>
            `;

            accessToken = response.credential;
            fetchUserLibrary();
        }

        function fetchUserLibrary() {
            if (!accessToken) return;

            $.ajax({
                url: "https://www.googleapis.com/books/v1/mylibrary/bookshelves/7/volumes",
                method: "GET",
                headers: { Authorization: `Bearer ${accessToken}` },
                success: data => displayLibraryBooks(data.items || []),
                error: () => $('#bookshelfList').html('<p>Error fetching library books.</p>')
            });
        }

        function renderBooks(templateId, containerId, books) {
            const template = $(`#${templateId}`).html();
            const rendered = Mustache.render(template, { books });
            $(`#${containerId}`).html(rendered);
        }

        function displaySearchResults(books) {
            const formattedBooks = books.map(book => ({
                image: book.volumeInfo.imageLinks?.thumbnail || 'https://via.placeholder.com/100x150',
                title: book.volumeInfo.title,
                authors: book.volumeInfo.authors?.join(', ') || 'Unknown Author',
                infoLink: book.volumeInfo.infoLink
            }));
            renderBooks('book-template', 'bookList', formattedBooks);
        }

        function displayLibraryBooks(books) {
            const formattedBooks = books.map(book => ({
                image: book.volumeInfo.imageLinks?.thumbnail || 'https://via.placeholder.com/100x150',
                title: book.volumeInfo.title,
                authors: book.volumeInfo.authors?.join(', ') || 'Unknown Author',
                infoLink: book.volumeInfo.infoLink
            }));
            renderBooks('book-template', 'bookshelfList', formattedBooks);
        }

        $('#searchButton').click(() => {
            const query = $('#searchInput').val().trim();
            if (!query) return alert('Please enter a search term.');
            searchBooks(query, 1);
        });

        function searchBooks(query, page) {
            const startIndex = (page - 1) * booksPerPage;
            $.ajax({
                url: `https://www.googleapis.com/books/v1/volumes?q=${encodeURIComponent(query)}&startIndex=${startIndex}&maxResults=${booksPerPage}&key=AIzaSyC7LacympO_n-WrND9RVNj88UXOmmpZUq8`,
                method: 'GET',
                success: response => displaySearchResults(response.items || []),
                error: () => $('#bookList').html('<p>Error fetching search results.</p>')
            });
        }

        $('#gridViewButton').click(() => $('#bookList').removeClass('list-view').addClass('grid-view'));
        $('#listViewButton').click(() => $('#bookList').removeClass('grid-view').addClass('list-view'));

        function parseJwt(token) {
            const base64Url = token.split('.')[1];
            const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
            const jsonPayload = decodeURIComponent(atob(base64).split('').map(c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
            return JSON.parse(jsonPayload);
        }

        function signOut() {
            accessToken = null;
            document.getElementById('user-info').innerHTML = '<p>You have signed out.</p>';
            $('#bookshelfList, #bookList, #pagination, #bookDetails').empty();
        }
    </script>
</body>
</html>
